= javascript_include_tag "jquery.validate"
= stylesheet_link_tag    "chapter", :media => "all"
.content.wrapper
  .content-a
    .Creation-form
      %h1.label-34 Chapter Creation
      %h3.label-11{:style => "padding-top: 25px;"} Founder Information
      .Info
        %h4.info_label Name: #{@current_user.fullname}
        %br
        %h4.info_label Email Id: #{@current_user.email}
      %h3.label-11{:style => "padding-top: 25px;"} Chapter Details
      = semantic_form_for @chapter do |f|
        - showclass = (f.object.chapter_type == "professional" ? "display:none" : "display:block")
        / %div{:style => "margin:25px 0px 10px 0px; width:60%;"}
        /   = f.label  "Chapter Name" , :class => 'info_label', :style => "margin-right:10px;    line-height: 23px;"
        /   = f.input :name, :placeholder => 'Chapter Name' ,  :label =>false ,  :input_html => {:class => "textboxes flt-right", :style => "width: 76%;margin-top:-30px;margin-right:5px;"} 
        #Form_ch        
          .form_r            
            %span.info_label{:style => "margin-right:10px;margin-top:25px;  line-height: 33px;"} Chapter Type        
            %span.chapter_type{:style => "padding-left:0px"}         
              = f.radio_button :chapter_type , 'student', :checked =>true , :class => "radio"
              = f.label :student ,"Student" , :class => 'r_label'
              = f.radio_button :chapter_type , 'professional', :class => "radio"
              = f.label :professional ,"Professional" , :class => 'r_label'
          .drop_list
            .one_side
              %div               
                -#= f.country_select :country_name , priority: %w(US CA), prompt: 'Please select a country', :input_html =>  {:class => "textboxes"}
                = f.input :country_name,  :label => false ,  :as => :select, :collection => Country.all, prompt: 'Please select a country', :input_html =>  {:style => "height:33px;width:292px",:class => "textboxes"}
                -#= f.hidden_field :country_id, :value => 1
              %div#chapter_state
                -#= render partial: 'subregion_select', locals: {parent_region: f.object.country_name}
                = f.input :state_name,  :label => false ,  :as => :select, :collection => [""], prompt: 'Please select a state', :input_html =>  {:style => "height:33px;width:292px",:class => "textboxes"}
                -#= f.hidden_field :state_id,  :value => 1
              %div#chapter_city
                -#= f.input :city_name , :placeholder => 'City',  :label => false ,  :input_html =>  {:class => "textboxes"}
                = f.input :city_name,  :label => false ,  :as => :select, :collection => [""], prompt: 'Please select a city', :input_html =>  {:style => "height:33px;width:292px",:class => "textboxes"}
                -#= f.hidden_field :city_id,  :value => 1
            .two_side{:id => "ct_selection" , :style => "#{showclass}"}
              %div
                = f.input :locality ,  :placeholder => 'Locality' , :label => false ,  :input_html => {:class => "textboxes"}
              %div
                = f.input :address,   :placeholder => 'Address' , :label => false,  :input_html => {:class => "textboxes"}
              %div
                = f.input :landmark,   :placeholder => 'Landmark' , :label => false,  :input_html => {:class => "textboxes"}
              %div
                = f.input :institution,   :placeholder => 'Institution' , :label => false,  :input_html => {:class => "textboxes"}
          %h3.label-11{:style => "padding-top: 20px;"} Chapter Proposal
          .proposal
            %h4.ch_label To: admin@cloudfoundry.com
            %div{:style=> "height:15px;"} &nbsp;
            = f.semantic_fields_for :messages do |msg|
              = msg.input :body, :label => false, :input_html => {  :class => "send_text" ,:style => "margin-bottom: 5px;padding-left: 5px;padding-top: 5px;width: 59%;height: 142px;" }
              %br
              = msg.input :sender_id , :as => :hidden, :value => current_user.id
              = msg.input :received_id , :as => :hidden, :value => @admin.id
            = f.submit 'SEND PROPOSAL' , :class => 'send'


:javascript
  $(document).ready(function(){

    $('#new_chapter').validate({
      rules: {
        "chapter[country_name]": {
          required: true
        },
        "chapter[state_name]": {
          required: true
        },
        "chapter[city_id]": {
          required: true
        },
        "chapter[locality]":{
          required: true
        },
        "chapter[address]":{
          required: true
        },
        "chapter[landmark]":{
          required: true
        },
        "chapter[institution]":{
          required: true
        },
        "chapter[messages_attributes][0][body]":{
          required: true
        }
      }
    });


    $('select#chapter_state_name').attr('disabled', 'disabled');
    $('select#chapter_country_name').change(function(event) {
      if($('select#chapter_country_name').val() != ""){
        $('select#chapter_state_name').attr('disabled',false);
      }
      else if($('select#chapter_country_name').val() == ""){
        $('select#chapter_state_name').attr('disabled', 'disabled');
      }
      var country_code = $(this).val();
      //send_ajax_request("get","/chapters/subregion_options",country_code,"script");
      $.ajax({
        url:"/chapters/subregion_options",
        dataType: "script",
        data:{country_id:country_code},
        type: "GET",
        success:function(data){
        },
        error:function(error){
        }
      });
    });

    $('select#chapter_city_name').attr('disabled', 'disabled');

  });
