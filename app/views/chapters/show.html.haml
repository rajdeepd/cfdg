= javascript_include_tag "jquery.validate"
.content.wrapper
  .content-c
    .cc-top
      .banner-div{:style => "margin-bottom:5px;"}
        .cfb-div
          %h5.label-1 DEPLOY & SCALE
          %h6.label-2 Focus on Your App,Not Plumbing
      .div-b
        %img.bg-logo-b{:src => "/assets/logo-b.png"}
        %br/
        -if !@is_part_of_chapter
          - if @current_user && ChapterMember.am_i_blocked(@chapter.id,@current_user.id)
            %a.btn-a{:href => "#"} BLOCKED!
          - else
            = form_tag join_a_chapter_chapters_path,:class => "join_form", :method => :post do
              = hidden_field_tag "chapter_id", "#{@chapter.id}"
              - if @current_user.blank?
                %a.btn-a{:href => "#{signin_path}"} JOIN US!
              - else
                = submit_tag 'JOIN US!' , :class => "btn-a join_us"
        -else
          - if @current_user && ChapterMember.am_i_blocked(@chapter.id,@current_user.id)
            %a.btn-a{:href => "#"} BLOCKED!
          -else
            = form_tag unjoin_a_chapter_chapters_path, :class => "unjoin_form", :method => :post do
              = hidden_field_tag "chapter_id", "#{@chapter.id}"
              - if @current_user.blank?
                %a.btn-a{:href => "#{signin_path}"} JOIN US!
              - elsif(!ChapterMember.am_i_coordinator?(@current_user.id, @chapter.id))
                = submit_tag 'UNJOIN' , :class => "btn-a join_us"
      .div-a
        %h2.label-17 #{@chapter.try(:name)}
        %h5.label-18 Location: #{@chapter.try(:city_name)} | Founded on #{Time.parse(@chapter.try(:created_at).to_s).strftime('%b %d, %Y')}
        %h5.label-20
          Founded by
          %a.label-20{:href => "#"}#{@chapter.user.try(:fullname)}
          on #{Time.parse(@chapter.try(:created_at).to_s).strftime('%b %d, %Y')}
        %h5.label-19
          Primary Group Coordinator:
          %label.label-20
            =link_to @primary_coord.try(:user).email, profile_info_user_path( @primary_coord.user),:class => "label-my"
          - member = ChapterMember.get_member(@current_user.id, @chapter.id).try(:first) if @current_user.present?
          -if !@current_user.blank? and member.present?
            %br
            %span{:style=> "color:green;font-size:14px;"} Role: #{member.memeber_type.try(:titleize)}
          .clr
        -if @secondary_coords.present?
          %h5.label-19
            Group Coordinator:
            %label.label-20
              -@secondary_coords.each do |coord|
                = link_to coord.user.email, profile_info_user_path(coord.user),:class => "label-my"
      %ul.ul-e
        %li
          -if @current_user.present? and (ChapterMember.am_i_coordinator?(@current_user.id, @chapter.id))
            %a{:href => "#{chapter_members_chapter_path(@chapter)}",:class => "chapMem"}
              %h2.label-21 #{@totalcount}
              %h5.label-39 Members
          -else
            %h2.label-21 #{@totalcount}
            %h5.label-39 Members
        %li
          %h2.label-21 #{@chapter.events.try(:size)}
          %h5.label-39 Events
        %li{:style => "width:192px;height:133px;"}
          %i.bg-img-e{:style => "width:182px;height:123px; "}
          .black-bar
            0 Photos in Event Name...
          .info-bar
            %h5.label-40
              %span{:style => "font-size:17px;"} Status:
              %b{:style => "color: orange;font-size: 16px;text-transform: uppercase;font-weight: bold;"}= @chapter.try(:chapter_status)
            - last_event = @past_events.try(:first)
            - if last_event.present?
              %h5.label-40 Last Event Date: #{Time.parse(last_event.event_start_date.to_s).strftime('%b %d, %Y')}


    .cc-left
      %ul.ul-f
        %li{:style=>"padding: 7px 20px;"}
          %a{:href => "#",:style => "font-size:20px;", :id=>"chapter_page_posts", :chapter_id => @chapter.id} Post
          %i.bg-arrow-down-b
        %li.ulf-selected{:style=>"padding: 7px 20px;"}
          %a{:href => "#" , :style => "font-size:20px;" ,:id=>"chapter_page_events", :chapter_id => @chapter.id} Events
          %i.bg-arrow-down-b
        / %li
        /   %a{:href => "#"} Photos
        /   %i.bg-arrow-down-b
        -if @current_user.present? and (ChapterMember.am_i_coordinator?(@current_user.id, @chapter.id))
          %li{:style => "float:right"}
            %a.cp{:href => "#{profile_path}" , :id=>"create_event_from_chapter", :chapter_id=> @chapter.id} + Create Event

      #chapter_show_events
        = render '/events/events_list'
    /=render '/events/comment_partial'
    - if @current_user.present?
      .inviteViaEmails.chapter
        #invitationForm
          <strong>Invite Friends</strong>
          = form_tag(invite_friends_chapter_path(:chapter => @chapter), :class => "new_email", :method => 'get') do
            = text_area_tag "email",nil, :class => 'email',:placeholder => "Enter Friend's email",:style => "resize: none;"
            -#%span.help-block eg. example@yopmail.com.
            = submit_tag 'Invite', :class => "multiple_email"
        #mail_error

:javascript 
  Chapters.init();
  Events.init();

:javascript

  $(document).ready(function(){
    $(".multiple_email").on("click",function(event){
      var value = $(".email").val();
      var validity = $(validateMultipleEmailsCommaSeparated(value));
      if(validity["selector"]=="false"){
        event.preventDefault();
        //$(".inviteFriend").append('<div id="error">please enter valid email address</div>');
        $("#invitationForm").append('<div id="error">please enter valid email address</div>');
        $("#error").fadeOut(4000,function(){
          $("#error").remove();
        });
      }
    });

    function validateMultipleEmailsCommaSeparated(value){
      var comma = value.split(/\s*[,;]\s*|\s{1,}|[\r\n]+/).join(",");
      var result = comma.split(",");
      var regex=/\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b/i;
      for(var i = result.length;i >0 ;i--){
        if(regex.test(result[i-1])){
          //console.log("true")
          //return "true";

        }
        else{
          console.log("false")
          return "false";
        }
      }
    }


  });




